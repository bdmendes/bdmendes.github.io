---
layout: default
title: Poetry
---

{% assign grouped_by_year = site.poetry | group_by: "year" | sort: "name" | reverse %}
{% assign all_texts = "" | split: "" %}
{% for year in grouped_by_year %}
  {% assign year_texts = year.items | sort: "number" | reverse %}
  {% for text in year_texts %}
    {% assign all_texts = all_texts | push: text %}
  {% endfor %}
{% endfor %}

<div class="flex gap-2">
  <input
    type="text"
    id="searchInput"
    placeholder="Pesquisar poemas..."
    class="box p-2 w-full mb-4 rounded-md flex-1">
  <select id="yearFilter" class="box p-2 mb-4 rounded-md">
    <option value="" autocomplete="off">Ano</option>
    {% assign years = site.poetry | map: "year" | uniq | sort | reverse %}
    {% for year in years %}
      <option value="{{ year }}">{{ year }}</option>
    {% endfor %}
  </select>
</div>

<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
  {% for text in all_texts %}
    <div class="box poetry-item{% if forloop.index > 12 %} hidden{% endif %}" data-year="{{ text.year }}">
      <a href="{{ text.url }}">
        <img
          loading="lazy"
          src="/assets/background/{{ text.background }}"
          alt="{{ text.title }}"
          class="aspect-[2/1] object-cover mx-auto w-full max-w-sm sm:max-w-full brightness-90" />
      </a>
      <div class="px-2 py-1 w-full">
        <a href="{{ text.url }}" class="text-inherit text-center poem-title">{{ text.title }}</a>
      </div>
    </div>
  {% endfor %}
</div>

<div class="flex flex-col">
  <button id="showMore" class="box p-2 mx-auto rounded-full mt-4">Ver mais</button>
  <p id="noResults" class="hidden mt-2">Não foram encontrados poemas com título correspondente.</p>
</div>

<style>
  #showMore:checked ~ .grid .box.hidden {
    display: block;
  }
</style>

<script>
  const MAX_BOXES = 12;
  const toggleShowMore = (show) => document.getElementById("showMore").style.display = show ? 'block' : 'none';
  const toggleYearFilter = (show) => document.getElementById("yearFilter").style.display = show ? 'block' : 'none';
  const resetYearFilter = () => document.getElementById('yearFilter').value = "";

  // Show More functionality
  document.getElementById("showMore").addEventListener("click", function() {
    const hiddenBoxes = document.querySelectorAll('.grid .box.hidden');
    for (let i = 0; i < MAX_BOXES && i < hiddenBoxes.length; i++) {
      hiddenBoxes[i].classList.remove('hidden');
    }

    if (document.querySelectorAll('.grid .box.hidden').length === 0) {
      toggleShowMore(false);
    }
  });

  // Search functionality
  document.getElementById("searchInput").addEventListener("input", function() {
    const removeDiacritics = (str) => str.normalize('NFD').replace(/[\W_]+/g,"").replace(/[\u0300-\u036f]/g, '').trim().toLowerCase();;

    const query = removeDiacritics(this.value);
    const items = document.querySelectorAll('.poetry-item');

    resetYearFilter();

    if (query.length > 0) {
      toggleShowMore(false);
      toggleYearFilter(false);
    } else if (document.querySelectorAll('.grid .box.hidden').length > 0) {
      toggleShowMore(true);
      toggleYearFilter(true);
    }

    let found = 0;
    items.forEach(function(item) {
      const title = removeDiacritics(item.querySelector('.poem-title').textContent);
      if (found < MAX_BOXES && title.includes(query)) {
        item.classList.remove('hidden');
        found++;
      } else {
        item.classList.add('hidden');
      }
    });

    if (found === 0) {
      document.getElementById('noResults').classList.remove('hidden');
    } else {
      document.getElementById('noResults').classList.add('hidden');
    }
  });

  // Year filter functionality
  document.getElementById("yearFilter").addEventListener("change", function() {
    const selectedYear = this.value;
    const items = document.querySelectorAll('.poetry-item');

    let found = 0;
    items.forEach(function(item) {
      const itemYear = item.getAttribute('data-year');
      if ((selectedYear === "" && found < MAX_BOXES) || itemYear === selectedYear) {
        item.classList.remove('hidden');
        found++;
      } else {
        item.classList.add('hidden');
      }
    });

    // Adjust "Show More" visibility
    if (selectedYear !== "") {
      toggleShowMore(false);
    } else if (document.querySelectorAll('.grid .box.hidden').length > 0) {
      toggleShowMore(true);
    }
  });
</script>